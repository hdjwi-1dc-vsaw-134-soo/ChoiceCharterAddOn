import{b as u}from"./init-cbacef14.js";let i="https://admin.workadventu.re";function c(){const o=WA.player.userRoomToken;if(o===void 0)throw new Error("No userRoomToken found. The quests plugin can only work with WorkAdventure SAAS edition (at https://play.workadventu.re).");return o}async function l(o,e){if(!WA.player.isLogged)throw new Error("You must be logged to gain XP.");const r=new URL(`/api/quests/${o}/level-up`,i),a=await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:c()},body:JSON.stringify({xp:e})});if(!a.ok)throw new Error(`An error occurred. HTTP Code: ${a.status} ${a.statusText}.`);const n=await a.json();return n.awardedBadges.length>0&&(async()=>{for(const s of n.awardedBadges)await d(o,s)})().catch(s=>{console.error(s)}),n}async function d(o,e){const r=new URL(`/quests/${o}/badge/${e}/congratulations`,i);r.search=new URLSearchParams({token:c()}).toString(),await WA.ui.website.open({url:r.toString(),position:{vertical:"middle",horizontal:"middle"},allowApi:!0,visible:!0,size:{width:"100%",height:"100%"}})}console.log("Script started successfully");let t;WA.onInit().then(async()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags),WA.room.onEnterLayer("exit_zone").subscribe(async()=>{await l("1101_ESCAPE_ROOM_FIBONACCI_100_ROADS_OFFICE",10),console.log("Test passed")}),WA.room.onEnterLayer("clockZone").subscribe(()=>{const o=new Date,e=o.getHours()+":"+o.getMinutes();t=WA.ui.openPopup("clockPopup","It's "+e,[])}),WA.room.onEnterLayer("tv_zone").subscribe(()=>{WA.room.showLayer("tv-on")}),WA.room.onLeaveLayer("tv_zone").subscribe(()=>{WA.room.hideLayer("tv-on")}),WA.room.onEnterLayer("floor").subscribe(()=>{WA.room.hideLayer("roof"),WA.room.hideLayer("walls-bg-front"),WA.room.hideLayer("sign")}),WA.room.onLeaveLayer("floor").subscribe(()=>{WA.room.showLayer("roof"),WA.room.showLayer("walls-bg-front"),WA.room.showLayer("facade-furniture-bg"),WA.room.showLayer("sign")}),WA.room.onEnterLayer("rooms_floor").subscribe(()=>{WA.room.hideLayer("facade-furniture-fg"),WA.room.hideLayer("facade"),WA.room.hideLayer("facade-furniture-bg")}),WA.room.onLeaveLayer("rooms_floor").subscribe(()=>{WA.room.showLayer("facade-furniture-fg"),WA.room.showLayer("facade"),WA.room.showLayer("facade-furniture-bg")}),WA.room.onLeaveLayer("clockZone").subscribe(y),u().then(()=>{console.log("Scripting API Extra ready")}).catch(o=>console.error(o))}).catch(o=>console.error(o));function y(){t!==void 0&&(t.close(),t=void 0)}
