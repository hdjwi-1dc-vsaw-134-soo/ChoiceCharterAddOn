import{b as u}from"./init-cbacef14.js";let i="https://admin.workadventu.re";function c(){const o=WA.player.userRoomToken;if(o===void 0)throw new Error("No userRoomToken found. The quests plugin can only work with WorkAdventure SAAS edition (at https://play.workadventu.re).");return o}async function l(o){const e=new URL(`/api/quests/${o}`,i);e.search=new URLSearchParams({room:WA.room.id}).toString();const r=await fetch(e,{method:"GET",headers:{Authorization:c()}});if(!r.ok)throw new Error(`An error occurred. HTTP Code: ${r.status} ${r.statusText}.`);return await r.json()}async function d(o,e){if(!WA.player.isLogged)throw new Error("You must be logged to gain XP.");const r=new URL(`/api/quests/${o}/level-up`,i),t=await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:c()},body:JSON.stringify({xp:e})});if(!t.ok)throw new Error(`An error occurred. HTTP Code: ${t.status} ${t.statusText}.`);const n=await t.json();return n.awardedBadges.length>0&&(async()=>{for(const s of n.awardedBadges)await A(o,s)})().catch(s=>{console.error(s)}),n}async function A(o,e){const r=new URL(`/quests/${o}/badge/${e}/congratulations`,i);r.search=new URLSearchParams({token:c()}).toString(),await WA.ui.website.open({url:r.toString(),position:{vertical:"middle",horizontal:"middle"},allowApi:!0,visible:!0,size:{width:"100%",height:"100%"}})}console.log("Script started successfully");let a;WA.onInit().then(async()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const o=await l("1101_ESCAPE_ROOM_FIBONACCI_100_ROADS_OFFICE");WA.room.onEnterLayer("exit_zone").subscribe(async()=>{await d("1101_ESCAPE_ROOM_FIBONACCI_100_ROADS_OFFICE",10),console.log("Test passed")}),console.log(o),WA.room.onEnterLayer("clockZone").subscribe(()=>{const e=new Date,r=e.getHours()+":"+e.getMinutes();a=WA.ui.openPopup("clockPopup","It's "+r,[])}),WA.room.onEnterLayer("tv_zone").subscribe(()=>{WA.room.showLayer("tv-on")}),WA.room.onLeaveLayer("tv_zone").subscribe(()=>{WA.room.hideLayer("tv-on")}),WA.room.onEnterLayer("floor").subscribe(()=>{WA.room.hideLayer("roof"),WA.room.hideLayer("walls-bg-front"),WA.room.hideLayer("sign")}),WA.room.onLeaveLayer("floor").subscribe(()=>{WA.room.showLayer("roof"),WA.room.showLayer("walls-bg-front"),WA.room.showLayer("facade-furniture-bg"),WA.room.showLayer("sign")}),WA.room.onEnterLayer("rooms_floor").subscribe(()=>{WA.room.hideLayer("facade-furniture-fg"),WA.room.hideLayer("facade"),WA.room.hideLayer("facade-furniture-bg")}),WA.room.onLeaveLayer("rooms_floor").subscribe(()=>{WA.room.showLayer("facade-furniture-fg"),WA.room.showLayer("facade"),WA.room.showLayer("facade-furniture-bg")}),WA.room.onLeaveLayer("clockZone").subscribe(h),u().then(()=>{console.log("Scripting API Extra ready")}).catch(e=>console.error(e))}).catch(o=>console.error(o));function h(){a!==void 0&&(a.close(),a=void 0)}
